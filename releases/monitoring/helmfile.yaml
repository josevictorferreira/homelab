releases:
  - name: prometheus
    chart: prometheus-community/kube-prometheus-stack
    namespace: "{{ .Values.namespaces.monitoring }}"
    values:
      - values.yaml.gotmpl
    hooks:
      - events: ["prepare"]
        command: "sh"
        args: ["-c", "kubectl create namespace {{ .Values.namespaces.monitoring }} --dry-run=client -o yaml | kubectl apply -f - && sops -d grafana-secret.enc.yaml | kubectl apply -n {{ .Values.namespaces.monitoring }} -f -"]
